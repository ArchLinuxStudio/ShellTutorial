# 初识 Linux Shell

本书学习的第一步，就是要找到 Linux 终端的所在位置。目前较常见的图形化终端有 Konsole、Gnome terminal、xterm 等几种。一般安装后在各个发行版的菜单中搜索即可找到。Gnome terminal 和 Konsole 基本是当前各大流行 Linux 发行版预装最多的终端应用，功能也非常强大好用。而 xterm 是世界上第一款图形化终端软件，xterm 软件包在 X Window 出现之前就有了。其对于老式哑终端的模仿非常到位，可以仿真各类老式哑终端的色彩等行为。所谓的哑终端就是传统的利用通信电缆（一般是一条多线束的串行电缆）连接到 Unix 系统上的一台显示器和一个键盘。关于各个图形化终端的各类配置，同学们可以自行慢慢摸索。

除了上述的图形化终端，在 Linux 出现的早期，没有图形化界面可供操作，当时通常的方式是使用一个简单的哑终端操作 Unix 系统。当今 2020 年，这种连接方式基本早已不存在了，但是你仍然可以模拟此种连接方式。Linux 系统启动后，它会自动创建出一些虚拟控制台。虚拟控制台是运行在 Linux 系统内存中的终端会话。通过按键组合`ctrl + alt + (F1~F7)`，可以分别切换到多个不同的虚拟控制台。这种模式称作 Linux 控制台，它仿真了早期的硬接线控制台终端，而且是一种同 Linux 系统交互的直接接口。虚拟控制台一般也被称为 tty。tty 代表电传打字机（teletypewriter）。这是一个古老的名词，指的是一台用于发送消息的机器。

在开始使用 tty 后，你可以看到首先会让你输入要登录的用户名，输入用户名回车后会提示输入密码，需要注意的是，密码的输入是不会显示在屏幕上的，盲输完回车即可完成登录，屏幕不显示密码是正常的，不要以为自己的键盘坏了。

## 起步

在启动图形化终端后，你首先会看到一个待输入的命令提示符，类似 windows 系统中的 cmd。一般如下所示,显示了当前用户 ID 名 wallen，系统名为 archlinux。`~`这个波浪线代表你正处于 wallen 这个用户的个人目录下，路径为`/home/wallen`。

```bash
wallen@archlinux:~$
```

你可能听说过 Linux 中有非常多的命令，都记住各个命令的用法是不现实的，所以第一步我们来学习的命令就是 man 命令：一个用来查询各个命令如何使用命令。  
在 ArchLinux 上，你首先需要安装`man-db man-pages`两个包，如果是第一次安装，最好重启一下，以便 man-db.service 建立-k 搜索参数需要使用的 db 索引。

比如，现在想查询 xterm 命令的使用方式，那么输入执行如下命令即可

```bash
man xterm
```

执行后你可以看到标题，描述，以及一大堆的信息。首先要知道，man 命令是用来速查某种命令使用方式的，不是用来各个详细阅读的(当然你有时间愿意读也没问题)。
在这个界面你可以执行一些搜索操作，方式和在 vim 中类似，比如输入`/`斜杠加上你想搜索的单词进行搜索，`n`键跳到下一个匹配的位置等等。一般常规的查询一个命令的流程就是先看一下 Description 知道这个命令是干什么的，然后输入斜杠搜索一下你想查询的参数的含义，最后看完按`q`键退出。

如果不记得命令名怎么办？可以使用关键字搜索手册页。语法是：man -k 关键字。例如，要查找与终端相关的命令，可以输入 man -k terminal。

在 man 页面的左上角，可以看到`XTERM(1)`的字样。这个`(1)`代表的是手册类型，下面列举一下各个数字所代表的类型意义。

- 1:可执行程序或 shell 命令
- 2:系统调用
- 3:库调用
- 4:特殊文件
- 5:文件格式与约定
- 6:游戏
- 7:概览、约定及杂项
- 8:超级用户和系统管理员命令
- 9:内核例程

上面有的部分现在看不懂也没关系，该懂的时候你自然就懂了。~~虽然大多数人基本永远也用不着懂~~

一个命令偶尔会在多个内容区域都有对应的手册页。比如说，有个叫作 hostname(在 archlinux 中需要安装包`inetutils`) 的命令。手册页中既包括该命令的相关信息，也包括对系统主机名的概述。要想查看所需要的页面，可以输入 man section# topic。对手册页中的第 1 部分而言，就是输入 man 1 hostname。对于手册页中的第 7 部分，就是输入 man 7 hostname。

除了 man 命令可以查询 Linux 命令的使用方式，info 命令也可以进行查询(在 archlinux 中需要安装包`texinfo`)。这里不再详细讲述 info 命令，因为 man 命令已经可以覆盖绝大多数内容。

另外，大多数命令都可以接受-help 或--help 选项。例如你可以输入 hostname -help 来查看帮助。

除了万能的 man 命令，近几年还出现了一个非常流行的命令行帮助项目:tldr。其含义为太长不看的缩写。像它的名字一样，这个命令只输出某个命令的最简要的使用方式，对喜欢太长不看的人来说非常好用。在 archlinux 上可以直接通过 pacman -S tldr 进行安装。

```bash
tldr tar   #查看tar命令的简明使用方式
```

## 漫游文件系统

当登录系统并获得 shell 命令提示符后，你通常位于自己的主目录中。一般情况下，你会想去逛逛主目录之外的其他地方。本节将告诉你如何使用 shell 命令来实现这个目标。

稍微了解 Linux 文件系统的话就会知道，一般来说一个完整的 Linux 文件路径可能是这样的:

```bash
/home/wallen/Documents/test.cpp
```

这种完整的路径被称为`绝对路径`，即从根路径`/`到目标文件的完整路径结构,含义为 wallen 这个用户家路径下的 Documents 目录下，有一个名为 test.cpp 的文件。想查看当前所处的位置的绝对路径，可以使用命令`pwd`

```bash
pwd
/home/wallen/Documents/
```

与此对应的，另一个概念为`相对路径`。其代表当前路径为基准起点，对应的一个相对位置。比如当前你所处的路径为`/home/wallen/Documents`,此时想要去到 wallen 用户的桌面 Desktop 路径下，用相对路径即可表示为

```bash
../Desktop
```

其中`..`为双点符，表示当前目录的父目录。另外一个常用标识符为`.`单点符，标识当前目录自身。

在文件系统中变更目录位置的命令为`cd`，可以接受绝对路径或相对路径作为参数

```bash
#绝对路径的例子
cd /home/wallen/Documents/  #使用绝对路径的方式切换到/home/wallen/Documents/路径下
#相对路径的例子
cd ../Desktop               #使用绝对路径的方式切换到/home/wallen/Desktop/路径下
```

一般来说，要视情况来使用相对路径或者绝对路径。在上述例子中，使用相对路径可以少输入很多内容。若此时想要切换到/etc 路径下，则明显使用绝对路径较为方便

```bash
cd /etc         #如果使用绝对路径
cd ../../../etc #如果使用相对路径
```

cd 命令可以直接使用，不加任何参数，此时会默认切换到当前用户的家目录下，如`/home/wallen`。在终端中，如果你能看到提示符最后有一个`~`波浪线，它代表的就是当前的路径是当前用户的家目录。

此外，另一个常用的用法是`cd -`。此命令可以切换到你上次所处的文件系统路径位置下。在需要返回上次路径的时候，此命令非常高效实用。

## ls 查看文件(夹)信息

本节首先来学习一下查看文件与目录信息的相关命令。

ls 命令最基本的形式会显示当前目录下的文件和目录：

注意，ls 命令输出的列表是按字母排序的（按列排序而不是按行排序）。可用带-F 参数的 ls 命令轻松区分文件和目录。使用-F 参数可以得到如下输出。F 参数在目录名后加了正斜线（/），以方便用户在输出中分辨它们。类似地，它会在可执行文件（比如上面的 my_script 文件）的后面加个星号，以便用户找出可在系统上运行的文件。

Linux 经常采用隐藏文件来保存配置信息。在 Linux 上，隐藏文件通常是文件名以点号开始的文件。这些文件并没有在默认的 ls 命令输出中显示出来，因此我们称其为隐藏文件。要把隐藏文件和普通文件及目录一起显示出来，就得用到-a 参数。下面是一个带有-a 参数的 ls 命令的例子。所有以点号开头的隐藏文件现在都显示出来了。

-R 参数是 ls 命令可用的另一个参数，叫作递归选项。它列出了当前目录下包含的子目录中的文件。如果目录很多，这个输出就会很长。以下是-R 参数输出的简单例子。注意，首先-R 参数显示了当前目录下的内容，也就是之前例子中用户 home 目录下的那些文件。另外，它还显示出了用户 home 目录下所有子目录及其内容。只有 Music 子目录中包含了一个可执行文件 ILoveLinux.mp3。选项并一定要像例子中那样分开输入：ls –F –R。它们可以进行如下合并：ls –FR。在上一个例子中，子目录中没再包含子目录。如果有更多的子目录，-R 参数会继续进行遍历。正如你所看到的，如果目录结构很庞大，输出内容会变得很长。

在基本的输出列表中，ls 命令并未输出太多每个文件的相关信息。要显示附加信息，另一个常用的参数是-l。-l 参数会产生长列表格式的输出，包含了目录中每个文件的更多相关信息。这种长列表格式的输出在每一行中列出了单个文件或目录。除了文件名，输出中还有其他有用信息。输出的第一行显示了在目录中包含的总块数。在此之后，每一行都包含了关于文件（或目录）的下述信息：

- 文件类型，比如目录（d）、文件（-）、字符型文件（c）或块设备（b
- 文件的权限（参见第 6 章）
- 文件的硬链接总数；
- 文件属主的用户名；
- 文件属组的组名；
- 文件的大小（以字节为单位）；
- 文件的上次修改时间；
- 文件名或目录名。

-l 参数是一个强大的工具。有了它，你几乎可以看到系统上任何文件或目录的大部分信息。在进行文件管理时，ls 命令的很多参数都能派上用场。如果在 shell 提示符中输入 man ls，就能看到可用来修改 ls 命令输出的参数有好几页。别忘了可以将多个参数结合起来使用。你不时地会发现一些参数组合不仅能够显示出所需的内容，而且还容易记忆，例如 ls –alF。

由前面的例子可知，默认情况下，ls 命令会输出目录下的所有非隐藏文件。有时这个输出会显得过多，当你只需要查看单个少数文件信息时更是如此。幸而 ls 命令还支持在命令行中定义过滤器。它会用过滤器来决定应该在输出中显示哪些文件或目录。这个过滤器就是一个进行简单文本匹配的字符串。可以在要用的命令行参数之后添加这个过滤器：当用户指定特定文件的名称作为过滤器时，ls 命令只会显示该文件的信息。有时你可能不知道要找的那个文件的确切名称。ls 命令能够识别标准通配符，并在过滤器中用它们进行模式匹配：

- 问号（?）代表一个字符；
- 星号（\*）代表零个或多个字符。

在过滤器中使用星号和问号被称为文件扩展匹配（file globbing），指的是使用通配符进行模式匹配的过程。通配符正式的名称叫作元字符通配符（metacharacter wildcards）。除了星号和问号之外，还有更多的元字符通配符可用于文件扩展匹配。可以使用中括号。

```bash
ls -l my_scr[ai]pt
-rw-rw-r-- 1 christine christine  0 May 21 13:25 my_scrapt
-rwxrw-r-- 1 christine christine 54 May 21 11:26 my_script
```

在这个例子中，我们使用了中括号以及在特定位置上可能出现的两种字符：a 或 i。中括号表示一个字符位置并给出多个可能的选择。可以像上面的例子那样将待选的字符列出来，也可以指定字符范围，例如字母范围[a – i]。

```bash
ls -l f[a-i]ll
-rw-rw-r-- 1 christine christine 0 May 21 13:44 fall
-rw-rw-r-- 1 christine christine 0 May 21 13:44 fell
-rw-rw-r-- 1 christine christine 0 May 21 13:44 fill
```

另外，可以使用感叹号（!）将不需要的内容排除在外。

```bash
ls -l f[!a]ll
-rw-rw-r-- 1 christine christine 0 May 21 13:44 fell
-rw-rw-r-- 1 christine christine 0 May 21 13:44 fill
-rw-rw-r-- 1 christine christine 0 May 21 13:44 full
```

在进行文件搜索时，文件扩展匹配是一个功能强大的特性。它也可以用于 ls 以外的其他 shell 命令。本章随后的部分会有到更多相关的例子。

## 文件的处理

### 创建文件

touch 命令用于创建空白文件。如果作用于一个已有文件，可以更改其修改时间。  
如果只想改变访问时间，可用-a 参数

```bash
touch -a test_one
ls -l --time=atime test_one
```

如果只使用 ls –l 命令，并不会显示访问时间。这是因为默认显示的是修改时间。要想查看文件的访问时间，需要加入另外一个参数：--time=atime。有了这个参数，就能够显示出已经更改过的文件访问时间。

### 复制文件

## 文件夹的处理

<!--
以及符号链接和硬链接 是重点和难点
-->

## 文件的查看

可用 file 命令确定文件的文件类型。

```bash
file 1.txt
1.txt: ASCII text  #file命令不仅能确定文件中包含的文本信息，还能确定该文本文件的字符编码，ASCII
```

常见的文件类型还有如下几种

- directory 目录
- symbolic link to 'data_file' 符号链接
- Bourne-Again shell script, ASCII text executable 脚本文件
- /usr/bin/ls: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24  
  二进制可执行程序。file 命令能够确定该程序编译时所面向的平台以及需要何种类型的库。如果你有从未知源处获得的二进制文件，这会是个非常有用的特性
- JSON data

知道如何查看文件类型后，接下来学习如何查看文件内容。几个常见的命令是 cat, more 与 less。more 命令目前已经和 less 一样支持上下翻页，基本没有区别了。对于查看单个完整文件，群主更偏向直接使用 vim 查看。

有时存在一些巨型文件，如有些日志文件可以达到几十 GB 之大，这时候如果还整体查看文件，可能直接把 vim 等程序卡死了。此时需要的就是查看部分文件。常用的命令为 tail 和 head。

更常见的场景是查看文件的末尾，如日志的末尾，查看最新产生的内容。默认情况是查看此文件最后十行的内容。

```bash
tail log_file
```

可以向 tail 命令中加入-n 参数来修改所显示的行数。在下面的例子中，通过加入-n 2 使 tail 命令只显示文件的最后两行：

```bash
tail -n 2 log_file
```

-f 参数是 tail 命令的一个突出特性。它允许你在其他进程使用该文件时查看文件的内容。tail 命令会保持活动状态，并不断显示添加到文件中的内容。这是实时监测系统日志的绝妙方式。

head 命令，顾名思义，会显示文件开头那些行的内容。默认情况下，它会显示文件前 10 行的文本。类似于 tail 命令，它也支持-n 参数，这样就可以指定想要显示的内容了。这两个命令都允许你在破折号后面直接输入想要显示的行数：

```bash
head log_file
head -5 log_file
```
